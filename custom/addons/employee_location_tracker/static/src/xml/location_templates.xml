<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <!-- AI Dashboard Template -->
    <t t-name="employee_location_tracker.AIDashboard" owl="1">
        <div class="o_location_dashboard o_ai_dashboard">
            <div class="o_dashboard_header d-flex justify-content-between align-items-center mb-4">
                <h2 class="text-primary">Location Analytics Dashboard</h2>
                <div class="o_dashboard_actions">
                    <select class="form-control o_dashboard_filters me-2" t-on-change="onFilterChange">
                        <option value="7">Last 7 days</option>
                        <option value="30" selected="selected">Last 30 days</option>
                        <option value="90">Last 90 days</option>
                    </select>
                    <button class="btn btn-primary" t-on-click="onRefreshDashboard">
                        <i class="fa fa-refresh"/> Refresh
                    </button>
                </div>
            </div>

            <div t-if="state.loading" class="text-center p-4">
                <i class="fa fa-spinner fa-spin fa-2x text-primary"/>
                <div class="mt-2 text-muted">Loading dashboard data...</div>
            </div>

            <div t-if="!state.loading">
                <!-- Summary Cards -->
                <div class="o_dashboard_summary_cards">
                    <div class="o_summary_card o_fade_in">
                        <div class="o_summary_total_locations">
                            <div class="o_summary_value" t-esc="state.dashboardData.totalLocations or 0"/>
                            <div class="o_summary_label">Total Locations</div>
                        </div>
                    </div>
                    <div class="o_summary_card o_fade_in">
                        <div class="o_summary_employees">
                            <div class="o_summary_value" t-esc="state.dashboardData.uniqueEmployees or 0"/>
                            <div class="o_summary_label">Active Employees</div>
                        </div>
                    </div>
                    <div class="o_summary_card distance o_fade_in">
                        <div class="o_summary_distance">
                            <div class="o_summary_value" t-esc="state.dashboardData.totalDistance or '0'"/>
                            <div class="o_summary_label">Total Distance (km)</div>
                        </div>
                    </div>
                    <div class="o_summary_card anomalies o_fade_in">
                        <div class="o_summary_anomalies">
                            <div class="o_summary_value" t-esc="state.dashboardData.anomalies or 0"/>
                            <div class="o_summary_label">Anomalies</div>
                        </div>
                    </div>
                    <div class="o_summary_card confidence o_fade_in">
                        <div class="o_summary_confidence">
                            <div class="o_summary_value" t-esc="state.dashboardData.highConfidence or 0"/>
                            <div class="o_summary_label">High Confidence</div>
                        </div>
                    </div>
                    <div class="o_summary_card accuracy o_fade_in">
                        <div class="o_summary_accuracy">
                            <div class="o_summary_value" t-esc="state.dashboardData.avgAccuracy or '0'"/>
                            <div class="o_summary_label">Avg Accuracy (m)</div>
                        </div>
                    </div>
                </div>

                <!-- Recent Activities Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="o_ai_card">
                            <div class="card-header">
                                <h5 class="card-title mb-0">Recent Activities</h5>
                            </div>
                            <div class="card-body">
                                <div class="o_recent_activities">
                                    <div t-if="!state.dashboardData.recentActivities or state.dashboardData.recentActivities.length === 0" 
                                         class="text-muted text-center">
                                        No recent activities
                                    </div>
                                    <div t-else="">
                                        <div t-foreach="state.dashboardData.recentActivities" t-as="activity" t-key="activity.id"
                                             class="o_activity_item d-flex justify-content-between align-items-center mb-2">
                                            <div>
                                                <strong t-esc="activity.employee_id[1]"/><br/>
                                                <span class="text-muted" t-esc="getTimeAgo(activity.timestamp)"/>
                                            </div>
                                            <span t-attf-class="badge badge-#{activity.anomaly_detected ? 'warning' : 'success'}"
                                                  t-esc="activity.anomaly_detected ? 'Anomaly' : activity.location_type"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Insights Section -->
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="o_ai_card">
                            <h5 class="mb-3">AI Insights</h5>
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="o_ai_insight">
                                        <h6><i class="fa fa-brain"/> Pattern Analysis</h6>
                                        <p class="mb-0">Normal behavior patterns detected for most employees</p>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="o_ai_insight">
                                        <h6><i class="fa fa-exclamation-triangle"/> Anomaly Detection</h6>
                                        <p class="mb-0" t-esc="(state.dashboardData.anomalies || 0) + ' unusual patterns detected'"/>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="o_ai_insight">
                                        <h6><i class="fa fa-route"/> Route Optimization</h6>
                                        <p class="mb-0">Tracking efficiency and optimization opportunities</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </t>

    <!-- Location Widget Template -->
    <t t-name="employee_location_tracker.LocationWidget" owl="1">
        <div class="o_field_location_widget">
            <div t-if="isReadonly" class="o_location_readonly">
                <div t-if="state.latitude and state.longitude">
                    <div t-esc="'Lat: ' + state.latitude.toFixed(6) + ', Lng: ' + state.longitude.toFixed(6)"/>
                    <div t-if="state.accuracy" class="text-muted" t-esc="'Accuracy: Â±' + state.accuracy + 'm'"/>
                    <button class="btn btn-sm btn-secondary mt-2" type="button" t-on-click="onShowMap">
                        Show on Map
                    </button>
                </div>
                <div t-else="" class="text-muted">No location data</div>
            </div>
            
            <div t-else="" class="o_location_edit">
                <div class="form-group">
                    <label>Latitude</label>
                    <input class="form-control" type="number" step="any" 
                           t-model="state.latitude"
                           t-on-change="(ev) => this.onLocationChange('latitude', ev.target.value)"/>
                </div>
                
                <div class="form-group">
                    <label>Longitude</label>
                    <input class="form-control" type="number" step="any" 
                           t-model="state.longitude"
                           t-on-change="(ev) => this.onLocationChange('longitude', ev.target.value)"/>
                </div>
                
                <div t-if="state.accuracy" class="form-group">
                    <label>Accuracy (meters)</label>
                    <input class="form-control" type="number" readonly="readonly" t-att-value="state.accuracy"/>
                </div>
                
                <div class="btn-group mt-2">
                    <button class="btn btn-primary" type="button" 
                            t-on-click="onGetCurrentLocation"
                            t-att-disabled="state.isGettingLocation">
                        <span t-if="state.isGettingLocation">Getting location...</span>
                        <span t-else="">Get Current Location</span>
                    </button>
                    <button class="btn btn-secondary" type="button" t-on-click="onShowMap">
                        Show on Map
                    </button>
                </div>
            </div>
        </div>
    </t>

    <!-- Map Widget Template -->
    <t t-name="employee_location_tracker.MapWidget" owl="1">
        <div class="o_field_map_widget">
            <div class="o_map_container" style="height: 400px; width: 100%;" t-ref="mapContainer"/>
        </div>
    </t>

    <!-- Loading Spinner Template -->
    <t t-name="employee_location_tracker.LoadingSpinner" owl="1">
        <div class="text-center p-4">
            <i class="fa fa-spinner fa-spin fa-2x text-primary"/>
            <div class="mt-2 text-muted">Loading location data...</div>
        </div>
    </t>

    <!-- Error Message Template -->
    <t t-name="employee_location_tracker.ErrorMessage" owl="1">
        <div class="alert alert-danger" role="alert">
            <i class="fa fa-exclamation-triangle"/>
            <strong>Error:</strong> <span t-esc="props.message"/>
        </div>
    </t>

</templates>