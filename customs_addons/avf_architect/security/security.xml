<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Security Groups -->
    <record id="module_architect_category" model="ir.module.category">
        <field name="name">Architectural ERP</field>
        <field name="description">User access level for Architectural ERP</field>
        <field name="sequence">20</field>
    </record>

    <record id="architect_group_user" model="res.groups">
        <field name="name">User</field>
        <field name="category_id" ref="module_architect_category"/>
        <field name="implied_ids" eval="[(4, ref('base.group_user'))]"/>
        <field name="comment">Regular users of the Architectural ERP system.</field>
    </record>

    <record id="architect_group_manager" model="res.groups">
        <field name="name">Manager</field>
        <field name="category_id" ref="module_architect_category"/>
        <field name="implied_ids" eval="[(4, ref('architect_group_user'))]"/>
        <field name="users" eval="[(4, ref('base.user_admin'))]"/>
        <field name="comment">Managers of the Architectural ERP system.</field>
    </record>

    <!-- Multi-Company Rules -->
    <record id="architect_project_company_rule" model="ir.rule">
        <field name="name">Architect Project: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_project"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>


    <record id="architect_drawing_company_rule" model="ir.rule">
        <field name="name">Architect Drawing: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_drawing"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <record id="architect_survey_company_rule" model="ir.rule">
        <field name="name">Architect Survey: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_survey"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <record id="architect_document_company_rule" model="ir.rule">
        <field name="name">Architect Document: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_document"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <record id="architect_financial_tracking_company_rule" model="ir.rule">
        <field name="name">Architect Financial Tracking: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_financial_tracking"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Record Rules for Users -->
    <record id="architect_project_user_rule" model="ir.rule">
        <field name="name">Users: Access Own and Team Projects</field>
        <field name="model_id" ref="model_architect_project"/>
        <field name="domain_force">['|', ('user_id', '=', user.id), ('team_ids', 'in', user.id)]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
        <field name="perm_read" eval="True"/>
        <field name="perm_write" eval="True"/>
        <field name="perm_create" eval="True"/>
        <field name="perm_unlink" eval="False"/>
    </record>

    <record id="architect_document_user_rule" model="ir.rule">
        <field name="name">Users: Access Based on Document Level</field>
        <field name="model_id" ref="model_architect_document"/>
        <field name="domain_force">['|', '|', '|',
            ('access_level', '=', 'public'),
            ('access_level', '=', 'internal'),
            ('authorized_user_ids', 'in', user.id),
            ('author_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
    </record>

    <record id="architect_client_portal_user_rule" model="ir.rule">
        <field name="name">Users: Access Own Portal Records</field>
        <field name="model_id" ref="model_architect_client_portal"/>
        <field name="domain_force">[('partner_id.user_ids', 'in', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <!-- Portal Access Rules -->
    <record id="architect_project_portal_rule" model="ir.rule">
        <field name="name">Portal: Access Own Projects</field>
        <field name="model_id" ref="model_architect_project"/>
        <field name="domain_force">[('partner_id.user_ids', 'in', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <record id="architect_document_portal_rule" model="ir.rule">
        <field name="name">Portal: Access Published Documents</field>
        <field name="model_id" ref="model_architect_document"/>
        <field name="domain_force">[
            ('portal_visible', '=', True),
            ('project_id.partner_id.user_ids', 'in', user.id)
        ]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <!-- Manager Override Rules -->
    <record id="architect_manager_all_rule" model="ir.rule">
        <field name="name">Managers: Access All Records</field>
        <field name="model_id" ref="model_architect_project"/>
        <field name="domain_force">[(1, '=', 1)]</field>
        <field name="groups" eval="[(4, ref('architect_group_manager'))]"/>
    </record>

    <!-- Sensitive Data Protection -->
    <record id="architect_financial_sensitive_rule" model="ir.rule">
        <field name="name">Financial: Sensitive Data Access</field>
        <field name="model_id" ref="model_architect_financial_tracking"/>
        <field name="domain_force">['|', ('user_id', '=', user.id), ('project_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
    </record>

    <!-- AI Assistant Access -->
    <record id="architect_ai_assistant_user_rule" model="ir.rule">
        <field name="name">AI Assistant: User Access</field>
        <field name="model_id" ref="model_architect_ai_assistant"/>
        <field name="domain_force">[('user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
    </record>

    <!-- Team Collaboration Rules -->
    <record id="architect_team_company_rule" model="ir.rule">
        <field name="name">Architect Team: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_team"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <record id="architect_team_member_rule" model="ir.rule">
        <field name="name">Team Member: Access Own Teams</field>
        <field name="model_id" ref="model_architect_team_member"/>
        <field name="domain_force">['|', ('user_id', '=', user.id), ('team_ids.member_ids.user_id', 'in', [user.id])]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
    </record>

    <!-- Drawing Set Rules -->
    <record id="architect_drawing_set_company_rule" model="ir.rule">
        <field name="name">Drawing Set: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_drawing_set"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Client Dashboard Rules -->
    <record id="architect_client_dashboard_rule" model="ir.rule">
        <field name="name">Client Dashboard: Access Control</field>
        <field name="model_id" ref="model_architect_client_dashboard"/>
        <field name="domain_force">[('portal_id.partner_id.user_ids', 'in', user.id)]</field>
        <field name="groups" eval="[(4, ref('base.group_portal'))]"/>
    </record>

    <!-- Document Template Rules -->
    <record id="architect_document_template_company_rule" model="ir.rule">
        <field name="name">Document Template: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_document_template"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Project Stage Rules -->
    <record id="architect_project_stage_company_rule" model="ir.rule">
        <field name="name">Project Stage: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_project_stage"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <!-- Budget Rules -->
    <record id="architect_budget_company_rule" model="ir.rule">
        <field name="name">Budget: Multi-Company Rule</field>
        <field name="model_id" ref="model_architect_budget"/>
        <field name="domain_force">[('company_id', 'in', company_ids)]</field>
        <field name="global" eval="True"/>
    </record>

    <record id="architect_budget_user_rule" model="ir.rule">
        <field name="name">Budget: User Access</field>
        <field name="model_id" ref="model_architect_budget"/>
        <field name="domain_force">['|', ('manager_id', '=', user.id), ('project_id.user_id', '=', user.id)]</field>
        <field name="groups" eval="[(4, ref('architect_group_user'))]"/>
    </record>
</odoo>
