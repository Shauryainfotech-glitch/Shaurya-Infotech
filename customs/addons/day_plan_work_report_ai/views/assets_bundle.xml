<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- Assets for the web backend -->
        <template id="assets_backend" name="Day Plan Dashboard Backend Assets" inherit_id="web.assets_backend">
            <xpath expr="." position="inside">
                <!-- Include Chart.js library (using Odoo's own Chart.js) -->
                <script type="text/javascript" src="/web/static/lib/Chart/Chart.js"/>
                
                <!-- Include our JavaScript components -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/new_dashboard_client_action.js"/>
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/components/dashboard_chart.js"/>
                
                <!-- Include productivity dashboard components -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/components/dashboard/productivity_dashboard_action.js"/>
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/components/dashboard/productivity_dashboard.js"/>
                
                <!-- Include guaranteed working chart dashboard -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/guaranteed_chart_dashboard.js"/>
                
                <!-- Include calendar view components -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/views/day_plan_calendar/day_plan_calendar_view.js"/>
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/views/day_plan_calendar/day_plan_calendar_controller.js"/>
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/views/day_plan_calendar/day_plan_calendar_renderer.js"/>
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/views/day_plan_calendar/day_plan_calendar_model.js"/>
            </xpath>
        </template>
        
        <!-- XML Templates for web client -->
        <template id="assets_common" name="Day Plan Dashboard Common Assets" inherit_id="web.assets_common">
            <xpath expr="." position="inside">
                <!-- Include client-side templates -->
                <t t-call-assets="day_plan_work_report_ai.assets_dashboard_templates"/>
                <!-- Include day plan specific templates -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/day_plan_templates.xml"/>
                <!-- Include guaranteed chart dashboard template -->
                <script type="text/javascript" src="/day_plan_work_report_ai/static/src/guaranteed_chart_dashboard.xml"/>
            </xpath>
        </template>
        
        <!-- Define the templates bundle for client-side templates -->
        <template id="assets_dashboard_templates">
            <templates xml:space="preserve">
                <!-- Chart Component Template -->
                <t t-name="day_plan_work_report_ai.DashboardChart">
                    <div t-att-style="props.style || ''">
                        <canvas t-ref="chart"></canvas>
                    </div>
                </t>
                
                <!-- Include productivity dashboard XML template -->
                <t t-call="day_plan_work_report_ai.ProductivityDashboard"/>
                
                <!-- Main Dashboard Template -->
                <t t-name="day_plan_work_report_ai.NewProductivityDashboard">
                    <div class="o_new_productivity_dashboard py-3">
                        <!-- Header -->
                        <div class="container-fluid mb-4">
                            <div class="row">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <h1>Productivity Dashboard</h1>
                                        <div class="btn-group">
                                            <button t-on-click="printDashboard" class="btn btn-primary">
                                                <i class="fa fa-print me-2"></i>Print Dashboard
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Loading indicator -->
                        <div t-if="state.loading" class="d-flex justify-content-center my-5">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading...</span>
                            </div>
                        </div>

                        <div t-else="" class="container-fluid">
                            <!-- KPI Cards -->
                            <div class="row mb-4">
                                <div class="col-md-3">
                                    <div class="card bg-primary text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Total Plans</h6>
                                            <h2 class="mb-0" t-esc="state.totalPlans || 0"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-success text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Completed Plans</h6>
                                            <h2 class="mb-0" t-esc="state.completedPlans || 0"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-warning text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Plans Today</h6>
                                            <h2 class="mb-0" t-esc="state.plansToday || 0"/>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="card bg-info text-white">
                                        <div class="card-body">
                                            <h6 class="card-title">Productivity Score</h6>
                                            <h2 class="mb-0" t-esc="state.productivityScore || 0"/>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Charts Section -->
                            <div class="row">
                                <div class="col-md-6 mb-4" t-if="state.chartData">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Productivity Chart</h5>
                                        </div>
                                        <div class="card-body" style="height: 300px;">
                                            <t t-component="DashboardChart" data="state.chartData" type="'line'"/>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-6 mb-4" t-if="state.pieChartData">
                                    <div class="card">
                                        <div class="card-header">
                                            <h5 class="card-title mb-0">Task Distribution</h5>
                                        </div>
                                        <div class="card-body" style="height: 300px;">
                                            <t t-component="DashboardChart" data="state.pieChartData" type="'pie'"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </t>
            </templates>
        </template>

        <!-- CSS Styles for Dashboard -->
        <template id="dashboard_styles" name="Dashboard Styles" inherit_id="web.assets_common">
            <xpath expr="." position="inside">
                <style type="text/css">
                    .o_guaranteed_chart_dashboard {
                        background-color: #f8f9fc;
                        min-height: 100vh;
                    }

                    .card {
                        border: none;
                        border-radius: 0.35rem;
                        box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
                    }

                    .border-left-primary {
                        border-left: 0.25rem solid #4e73df;
                    }

                    .border-left-success {
                        border-left: 0.25rem solid #1cc88a;
                    }

                    .border-left-info {
                        border-left: 0.25rem solid #36b9cc;
                    }

                    .border-left-warning {
                        border-left: 0.25rem solid #f6c23e;
                    }

                    .text-xs {
                        font-size: 0.7rem;
                    }

                    .progress-sm {
                        height: 0.5rem;
                    }

                    .chart-area, .chart-pie, .chart-bar {
                        position: relative;
                    }

                    .chart-area canvas, .chart-pie canvas, .chart-bar canvas {
                        width: 100% !important;
                        height: 100% !important;
                    }
                </style>
            </xpath>
        </template>
    </data>
</odoo>